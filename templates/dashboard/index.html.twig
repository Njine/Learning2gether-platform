{% extends 'base.html.twig' %}

{% block title %}Hello DashboardController!{% endblock %}

{% block body %}

    <style>
        .flagbtn {
            cursor: pointer;
        }
    </style>

    <div class="container mt-5">

        <!-- add module button -->
        <div class="modules-container">
            <section class="row rowaddbutton" >
                <a href="{{ path('create_module') }}" class="call-to-action">
                    <button type="button" class="btn  btn-circle btn-xl"
                            data-toggle="tooltip" data-placement="right" title="Add new module">
                        <img class="addicon" src="{{ asset('assets/img/plusicon.svg') }}" alt="add icon">
                    </button>
                    <p>Create a new module </p>
                </a>
            </section>

            <section class="row">
                <a href="{{ path('forum') }}" class="call-to-action">
                    <button type="button" class="btn btn-circle btn-xl"
                            data-toggle="tooltip" data-placement="right" title="Go to forum">
                        <img class="addiconflag" src="{{ asset('assets/img/flagicon.svg') }}" alt="flag icon">
                    </button>
                    <p>Go to foum  </p>
                </a>
            </section>
        </div>


        <table class="mt-5 table table-hover text-center">
            <thead>
            <tr class="dash-lines">
                <th scope="col" class="header-dash">#</th>
                <th scope="col" class="header-dash">Module Name</th>
                <th scope="col" class="header-dash"># chapters</th>
                <th scope="col" class="header-dash"> Translations <i
                            title="This module's title and description translations.&#10;Click to go to that module's edit page."
                            class="help-icon far fa-question-circle"></i></th>
                <th scope="col" class="header-dash trigger">Check</th>
                <th scope="col" class="header-dash">Status</th>
                <th scope="col" class="header-dash">&#128269;</th>
            </tr>
            </thead>
            <tbody>
            {% for module in allModules %}
                {% set moduleArray = lmRepo.getModuleAsArray(module) %}
                {% if moduleArray is not empty %}
                    {% set moduleArray = moduleArray[0] %}
                    <tr class="dash-lines">
                        <th scope="row">{{ loop.index }}</th>
                        <td>{{ module.getTitle(language) }}</td>
                        <td>{{ module.chapters|length }}</td>
                        <td>
                            {% for moduleTL in moduleArray['translations'] %}
                                {% set badgeclass = 'badge-danger' %}
                                {% if moduleTL['title'] != '' and moduleTL['description'] != '' %}
                                    {% set badgeclass = 'badge-success' %}
                                {% endif %}
                                <a class="badge {{ badgeclass }}" href="{{ path('edit_module_translation', {'module': moduleArray['id'], lang: moduleTL['language']['code']}) }}">{{ moduleTL['language']['name'] }}</a>
                            {% endfor %}
                        </td>
                        <td>

                            <div id="flagbtn-{{ module.id }}" class="flagbtn badge badge-primary"
                                 onclick="checkModule({{ module.id }})">check
                            </div>
                        </td>
                        {% if module.isPublished %}
                            <td>
                                <div class="badge badge-success">Published</div>
                            </td>
                        {% else %}
                            <td id="publish-{{ module.id }}">
                                <div class="badge badge-warning">Unpublished</div>
                            </td>
                        {% endif %}
                        <td><a class="badge btn-skills" href="{{ path('dashboard_module', {module: module.id}) }}">View chapters</a></td>
                    </tr>
                    <tr class="module-rows">

                        {# sorry to the poor soul that has to style this #}
                        {# I did a lot of js styling on this one #}
                        {# displaying in a seperate table ruins the whole bootstrap table #}
                        {# maybe try bootstrap tootltips or popups ? #}
                        <td style="display: none;" class="module-alert" id="dump-{{ module.id }}"></td>
                    </tr>
                {% else %}
                    <tr class="text-center">
                        <th scope="row">{{ loop.index }}</th>
                        <td colspan="6">This module needs more chapters! {link to module overview}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>

    <script scrc="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
    <script>

    </script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <script src="{{ asset('assets/js/dashboardFlagging.js') }}"></script>
{% endblock %}
